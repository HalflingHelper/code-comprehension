<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="./jspsych/jspsych.js"></script>
    <script src="./jspsych/plugin-html-keyboard-response.js"></script>
    <script src="./jspsych/plugin-survey-text.js"></script>
    <script src="./jspsych/plugin-survey-multi-choice.js"></script>
    <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
    <link href="./jspsych/jspsych.css" rel="stylesheet" type="text/css" />
    <link href="./style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>



  </body>
  <script src="./test_data.js"></script>
  <script>
  const jsPsych = initJsPsych({
    override_safe_mode: true,
    // on_finish: uploadData
  });

    let timeline = [];

    const welcome = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: 'Welcome to the experiment! Press any key to begin.'
    }
    timeline.push(welcome);

    const instructions = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: 'In this experiment...',
      post_trial_gap: 0
    }
    timeline.push(instructions);


    // survey
    const yearsOptions = ["Less than 1", "1-2 Years", "3-5 years", "6+ years"];
    const skillOptions = ["Beginner", "Intermediate", "Advanced", "Expert"]
    const questionnaire = {
      type: jsPsychSurveyMultiChoice,
      questions: [
        {
          prompt: 'Years of programming experience?',
          name: 'programmingYears',
          options: yearsOptions,
          required: true
        },
        {
          prompt: 'Years of Python experience?',
          name: 'pythonYears',
          options: yearsOptions,
          required: true
        },
        {
          prompt: 'How would you describe your programming skill level?',
          name: 'programmingSkill',
          options: skillOptions,
          required: true
        },
        {
          prompt: 'How would you describe your Python skill level?',
          name: 'pythonSkill',
          options: skillOptions,
          required: true
        },
      ]
    }

    // timeline.push(questionnaire)


    // TODO: Update this to use test_data
    // TODO: Split into blocks
    var tests = [
      { code: `x = 5\n\tprint(x)` },
      { code: 'print("hello, world")' },
    ]

    

    // Do the wrappingo here
    var test_stimuli = tests.map(t => {
      return {
        code: '<div class="code-block">'+t.code + '</div>'
      }
    })




    var test = {
      type: jsPsychSurveyText,
      // TODO: Make this monospaced and whatever
      preamble: jsPsych.timelineVariable('code'),
      // preamble: () => {
      //   let n = jsPsych.timelineVariable('code')
      //   return `<code>` + jsPsych.timelineVariable('code') + `</code>`
      // },
      questions: [
        { prompt: 'What does the above code output?' }
      ],
      post_trial_gap: 1000,
    }

    var test_procedure = {
      timeline: [test],
      timeline_variables: test_stimuli,
      // randomize_order: true,
      // repetitions: 5
    };
    timeline.push(test_procedure);


    const subject_id = jsPsych.randomization.randomID(10);
    const filename = `${subject_id}.csv`;

    const save_data = {
      type: jsPsychPipe,
      action: "save",
      experiment_id: "1puogTq1MKFM",
      filename: filename,
      data_string: ()=>jsPsych.data.get().csv()
    };
    timeline.push(save_data);


    timeline.push({
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
          <div style="text-align:center; line-height:1.6;">
            <p>You're done! Thank you for participating.</p>
            <p>Your data has been automatically sent to OSF. You can visit your data at https://osf.io/2uznt/files</p>
            <p class="dim">Press any key to finish.</p>
          </div>`,
    })

    jsPsych.run(timeline);
  </script>
</html>
